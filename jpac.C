#include <iostream>
#include <string>
#include <fstream>
#include <sstream>
#include <random>
#include <cmath>
#include <stdlib.h>
#include <utility>
#include <map>
#include "TROOT.h"
#include "TMath.h"
#include "TCanvas.h"
#include "TGraphErrors.h"
#include "TF1.h"
#include "TCanvas.h"
#include "TAxis.h"
#include "../Eigen/Eigen/Dense"


using std::complex;
using namespace std;
using namespace Eigen;

vector<double> v_m;
double a[3][4];
double g[3][3];
double m0[3];
double c[3][3], d[3][3];

int m_model_n = 0;
int m_model_K = 0;

const int n_res = 3;
const int nmax = 4;

map<int,vector<pair<double,complex<double>>>> v_int;

double Cheby(double x, int n){
  if(n==0){
    return 1;
  }
  else if(n==1){
    return x;
  }
  else{
    return 2*x*Cheby(x,n-1)-Cheby(x,n-2);
  }
}

double omega_pole(double s, double s0){
  return s/(s+s0);
}

double omega_scaled(double s, double smin, double smax){
  return 2*(s-smin)/(smax-smin)-1;
}

double omega_polescaled(double s, double smin, double smax, double s0){
  return 2*(omega_pole(s,s0)-omega_pole(smin,s0))/(omega_pole(smax,s0)-omega_pole(smin,s0))-1; // this was min - max in the paper
}

void loadIntegrals(string label, int _L){
  string filename = "PHSPFUNCS/rhoN-" + label + "_bootstrap.txt";
  ifstream in(filename.c_str());
  assert(in.is_open());
  string line;
  int ct=0;
  while(in.is_open() && getline(in,line)){
    string s[13];
    istringstream ss(line);
    ss >> s[0] >> s[1] >> s[2] >> s[3] >> s[4] >> s[5] >> s[6] >> s[7] >> s[8] >> s[9] >> s[10] >> s[11] >> s[12];
    double sqrts = atof(s[0].c_str());
    complex<double> ch1, ch2, ch3;
    if(_L==0){
      ch1 = complex<double>(atof(s[1].c_str()),atof(s[2].c_str()));
      ch2 = complex<double>(atof(s[3].c_str()),atof(s[4].c_str()));
      ch3 = complex<double>(atof(s[5].c_str()),atof(s[6].c_str()));
    }
    else{
      ch1 = complex<double>(atof(s[7].c_str()),atof(s[8].c_str()));
      ch2 = complex<double>(atof(s[9].c_str()),atof(s[10].c_str()));
      ch3 = complex<double>(atof(s[11].c_str()),atof(s[12].c_str()));
    }
    v_int[0].push_back(make_pair(sqrts,ch1));
    v_int[1].push_back(make_pair(sqrts,ch2));
    v_int[2].push_back(make_pair(sqrts,ch3));
  }
}


complex<double> findInt(double sqrts, int chanID){
  vector<pair<double,complex<double>>> vec;
  if(v_int.count(chanID))
    vec = v_int[chanID];
  
  assert(vec.size());

  complex<double> returnMe;
  for(unsigned int i=0;i<vec.size();i++){
    if(vec.at(i).first > sqrts){
      double this_sqrts = vec.at(i).first;
      double last_sqrts = vec.at(i-1).first;
      double this_int_re = vec.at(i).second.real();
      double this_int_im = vec.at(i).second.imag();
      double last_int_re = vec.at(i-1).second.real();
      double last_int_im = vec.at(i-1).second.imag();
      double m_re = (this_int_re - last_int_re)/(this_sqrts - last_sqrts);
      double b_re = this_int_re - m_re * this_sqrts;
      double m_im = (this_int_im - last_int_im)/(this_sqrts - last_sqrts);
      double b_im = this_int_im - m_im * this_sqrts;
      returnMe = complex<double>(m_re*sqrts+b_re,m_im*sqrts+b_im);
      break;
    }
  }
  return returnMe;
}

complex<double> amp(double sqrts, int idx, int m_J){

  double s = pow(sqrts,2);
  double s0 = 1;
  double smin = 1;
  double smax = 2.5*2.5;

  double Egam = (pow(3.0969,2)-s)/(2*sqrts);
  VectorXd p = VectorXd::Zero(3);
  for(int i=0;i<3;i++)
    if(s-4*pow(v_m[i],2) > 0)
      p(i) = sqrt(s-4*pow(v_m[i],2))/2.;

  VectorXd n_vec = VectorXd::Zero(3);
  for(int i=0; i<3; i++){
    double omega = 0;
    if(m_model_n==0){
      omega = omega_pole(s,s0);
    }
    else if(m_model_n==1){
      omega = omega_scaled(s,smin,smax);
    }
    else if(m_model_n==2){
      omega = omega_polescaled(s,smin,smax,s0);
    }
    for(int n=0;n<nmax;n++)
      n_vec(i) += a[i][n]*Cheby(omega,n);
  }


  MatrixXd K_inv = MatrixXd::Zero(3,3);
  if(m_model_K==0){
    MatrixXd K = MatrixXd::Zero(3,3);
    for(int i=0;i<3;i++){
      for(int j=0;j<3;j++){
        if(i>j){
          K(i,j) = K(j,i);
          continue;
        }
        K(i,j) = c[i][j] + d[i][j]*s;
        for(int r=0;r<3;r++)
          K(i,j) += g[r][i]*g[r][j]/(pow(m0[r],2)-s);
      }
    }
    K_inv = K.inverse();
  }
  else{
    for(int i=0;i<3;i++){
      for(int j=0;j<3;j++){
        if(i>j){
          K_inv(i,j) = K_inv(j,i);
        }
        else{
          K_inv(i,j) = pow(c[i][j],2) - pow(d[i][j],2)*s; // these parameters are squared in reality, but not in the paper!
          for(int r=0;r<3;r++){
            K_inv(i,j) -= g[r][i]*g[r][j]/(pow(m0[r],2)-s);
          }
        }
      }
    }
  }

  MatrixXcd integral = MatrixXcd::Zero(3,3);
  for(int i=0;i<3;i++)
    integral(i,i) = findInt(sqrts,i);

  MatrixXcd K_invc = K_inv.cast<std::complex<double>>();
  MatrixXcd D = K_invc - integral;
  MatrixXcd D_inv = D.inverse();
  MatrixXd _ISO = MatrixXd::Zero(3,3);
  _ISO(0,0) = sqrt(3.);
  _ISO(1,1) = sqrt(4.);
  _ISO(2,2) = sqrt(3.);
  MatrixXcd D_ISO = D_inv * _ISO;
  complex<double> amp = complex<double>(0.,0.);
  for(int k=0;k<3;k++)
    amp += n_vec(k)*D_inv(k,idx); // put D_ISO here for correct isospin-scaling
  amp *= Egam*pow(p(idx),m_J);
  return sqrt(p(idx))*amp;
}

double plotAmp2(double *x, double *par){
  int idx = TMath::Nint(par[0]);
  int _J = TMath::Nint(par[1]);
  return norm(amp(x[0],idx,_J));
}

void jpac(string model, int _L){
  assert(_L==0 || _L==2);

  v_m.push_back(0.135);
  v_m.push_back(0.497);
  v_m.push_back(0.762);
  loadIntegrals(model,_L);

  if(!model.compare("inputcddcm11newc3")){ // 1
    if(_L==0){ 
      m_model_K = 1;
      m_model_n = 2;

      a[0][0] = -40.312; // pipi
      a[0][1] = 156.891;
      a[0][2] = 220.025;
      a[0][3] = 99.516;

      a[1][0] = -7.767; // KK
      a[1][1] = 428.448;
      a[1][2] = 489.943;
      a[1][3] = 205.654;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = -0.061; // pipi
      g[1][0] = 0.607;
      g[2][0] = 4.410;

      g[0][1] = 0.776; // KK
      g[1][1] = 0.952;
      g[2][1] = 8.443;

      g[0][2] = -0.667; // rho rho
      g[1][2] = 0.417;
      g[2][2] = -0.401;

      m0[0] = sqrt(0.908);
      m0[1] = sqrt(3.161);
      m0[2] = sqrt(7.700);

      c[0][0] = 2.512;
      c[0][1] = 3.380; c[1][0] = 3.380;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = 4.752;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 0.040;

      d[0][0] = 0.495;
      d[0][1] = 0.015; d[1][0] = 0.015;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.775;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0;
    }
    else{
      m_model_K = 0;
      m_model_n = 2;

      a[0][0] = 2.724; // pipi
      a[0][1] = -0.052;
      a[0][2] = 1.205;
      a[0][3] = 0.616;

      a[1][0] = 1.973; // KK
      a[1][1] = 5.417;
      a[1][2] = 0.625;
      a[1][3] = -0.649;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = 3.275; // pipi
      g[1][0] = -0.614;
      g[2][0] = -57.319;

      g[0][1] = 1.413; // KK
      g[1][1] = 4.596;
      g[2][1] = 52.174;

      g[0][2] = 0.283; // rho rho
      g[1][2] = 1.113;
      g[2][2] = 14.094;

      m0[0] = sqrt(1.954);
      m0[1] = sqrt(2.650);
      m0[2] = sqrt(11.921);

      c[0][0] = -290.233;
      c[0][1] = 282.875; c[1][0] = 282.875;
      c[0][2] = 95.463; c[2][0] = 95.463;
      c[1][1] = -228.333;
      c[1][2] = -86.069; c[2][1] = -86.069;
      c[2][2] = -25.988;

      d[0][0] = -18.417;
      d[0][1] = 16.215; d[1][0] = 16.215;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -20.303;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0;
    }
  }
  else if(!model.compare("inputcddcm3newc3")){ // 2
    if(_L==0){ 
      m_model_K = 1;
      m_model_n = 1;

      a[0][0] = 157.245; // pipi
      a[0][1] = 162.476;
      a[0][2] = 62.922;
      a[0][3] = 50.439;

      a[1][0] = 150.521; // KK
      a[1][1] = 118.193;
      a[1][2] = 54.494;
      a[1][3] = 70.733;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = 0.651; // pipi
      g[1][0] = 0.223;
      g[2][0] = 1.219;

      g[0][1] = 0.931; // KK
      g[1][1] = -0.188;
      g[2][1] = 1.263;

      g[0][2] = 0.610; // rho rho
      g[1][2] = -0.314;
      g[2][2] = -0.292;

      m0[0] = sqrt(4.247);
      m0[1] = sqrt(2.293);
      m0[2] = sqrt(6.406);

      c[0][0] = 1.081;
      c[0][1] = 1.82; c[1][0] = 1.82;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = 2.063;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 1.185;

      d[0][0] = 0.381;
      d[0][1] = 0.784; d[1][0] = 0.784;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.887;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0.534;
    }
    else{
      m_model_K = 0;
      m_model_n = 1;

      a[0][0] = -604.559; // pipi
      a[0][1] = -816.649;
      a[0][2] = -276.267;
      a[0][3] = -47.735;

      a[1][0] = 309.966; // KK
      a[1][1] = 523.716;
      a[1][2] = 294.291;
      a[1][3] = 74.811;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = 2.381; // pipi
      g[1][0] = 0.137;
      g[2][0] = 1.061;

      g[0][1] = 6.949; // KK
      g[1][1] = 1.463;
      g[2][1] = 0.350;

      g[0][2] = 61.196; // rho rho
      g[1][2] = -5.565;
      g[2][2] = 0.;

      m0[0] = sqrt(19.512);
      m0[1] = sqrt(2.423);
      m0[2] = sqrt(1.498);

      c[0][0] = 2.643;
      c[0][1] = -0.723; c[1][0] = -0.723;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = -1.287;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -820.930;

      d[0][0] = -0.878;
      d[0][1] = -0.558; d[1][0] = -0.558;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.629;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 128.239;
    }
  }
  else if(!model.compare("inputcddcm5newc3")){ // 3
    if(_L==0){ 
      m_model_K = 1;
      m_model_n = 2;

      a[0][0] = -110.243; // pipi
      a[0][1] = -35.610;
      a[0][2] = 59.275;
      a[0][3] = 28.277;

      a[1][0] = -151.390; // KK
      a[1][1] = 119.745;
      a[1][2] = 245.904;
      a[1][3] = 89.554;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = 0.387; // pipi
      g[1][0] = -0.844;
      g[2][0] = -3.258;

      g[0][1] = -2.178; // KK
      g[1][1] = -1.326;
      g[2][1] = 0.648;

      g[0][2] = 0.584; // rho rho
      g[1][2] = 0.383;
      g[2][2] = -0.518;

      m0[0] = sqrt(0.001);
      m0[1] = sqrt(3.451);
      m0[2] = sqrt(9.151);

      c[0][0] = -1.628;
      c[0][1] = -2.497; c[1][0] = -2.497;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = -3.630;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = -0.360;

      d[0][0] = 0.141;
      d[0][1] = 1.078; d[1][0] = 1.078;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = 1.756;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0.;
    }
    else{
      m_model_K = 0;
      m_model_n = 2;

      a[0][0] = -45.501; // pipi
      a[0][1] = -143.801;
      a[0][2] = -71.387;
      a[0][3] = -10.572;

      a[1][0] = 48.969; // KK
      a[1][1] = 88.319;
      a[1][2] = 34.708;
      a[1][3] = 5.095;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = 1.048; // pipi
      g[1][0] = -0.355;
      g[2][0] = 0.751;

      g[0][1] = 0.533; // KK
      g[1][1] = 0.899;
      g[2][1] = 0.264;

      g[0][2] = -1.319; // rho rho
      g[1][2] = 0.432;
      g[2][2] = 1.578;

      m0[0] = sqrt(1.823);
      m0[1] = sqrt(2.390);
      m0[2] = sqrt(3.752);

      c[0][0] = 1.656;
      c[0][1] = 3.748; c[1][0] = 3.748;
      c[0][2] = -0.446; c[2][0] = -0.446;
      c[1][1] = 11.214;
      c[1][2] = 0.376; c[2][1] = 0.376;
      c[2][2] = 1.812;

      d[0][0] = -1.288;
      d[0][1] = -2.259; d[1][0] = -2.259;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -4.301;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0;
    }
  }
  else if(!model.compare("inputcddcm6newc3")){ // 4
    if(_L==0){
      m_model_K = 1;
      m_model_n = 2;

      a[0][0] = -44.149; // pipi
      a[0][1] = 128.785;
      a[0][2] = 196.149;
      a[0][3] = 94.886;

      a[1][0] = -1.180; // KK
      a[1][1] = 433.016;
      a[1][2] = 491.470;
      a[1][3] = 211.380;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = -0.699; // pipi
      g[1][0] = -0.276;
      g[2][0] = 3.613;

      g[0][1] = -1.072; // KK
      g[1][1] = 0.488;
      g[2][1] = 7.414;

      g[0][2] = 0.415; // rho rho
      g[1][2] = 0.433;
      g[2][2] = 0.336;

      m0[0] = sqrt(3.200);
      m0[1] = sqrt(1.556);
      m0[2] = sqrt(7.506);

      c[0][0] = -2.065;
      c[0][1] = 3.253; c[1][0] = 3.253;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = 4.694;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 0.004;

      d[0][0] = 0.739;
      d[0][1] = -0.617; d[1][0] = -0.617;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -1.169;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0.;
    }
    else{
      m_model_K = 0;
      m_model_n = 2;

      a[0][0] = 232.738; // pipi
      a[0][1] = -197.597;
      a[0][2] = 172.533;
      a[0][3] = -34.434;

      a[1][0] = 53.519; // KK
      a[1][1] = 202.272;
      a[1][2] = 25.053;
      a[1][3] = 5.299;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = 0.366; // pipi
      g[1][0] = -0.265;
      g[2][0] = -1.341;

      g[0][1] = 0.267; // KK
      g[1][1] = 0.992;
      g[2][1] = 0.890;

      g[0][2] = 0.526; // rho rho
      g[1][2] = 0.416;
      g[2][2] = 2.648;

      m0[0] = sqrt(1.478);
      m0[1] = sqrt(2.362);
      m0[2] = sqrt(5.489);

      c[0][0] = -0.378;
      c[0][1] = 0.294; c[1][0] = 0.294;
      c[0][2] = 2.724; c[2][0] = 2.724;
      c[1][1] = 0.684;
      c[1][2] = -1.317; c[2][1] = -1.317;
      c[2][2] = -0.763;

      d[0][0] = -0.430;
      d[0][1] = 0.278; d[1][0] = 0.278;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.290;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0;
    }
  }
  else if(!model.compare("inputcddcm7newc3")){ // 5
    if(_L==0){ 
      m_model_K = 1;
      m_model_n = 0;

      a[0][0] = 2011.105; // pipi
      a[0][1] = -1401.874;
      a[0][2] = -1722.938;
      a[0][3] = 1991.570;

      a[1][0] = -2104.490; // KK
      a[1][1] = 6943.877;
      a[1][2] = -7896.936;
      a[1][3] = 5000.622;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = -0.027; // pipi
      g[1][0] = 0.660;
      g[2][0] = 0.452;

      g[0][1] = 0.426; // KK
      g[1][1] = 0.725;
      g[2][1] = -0.147;

      g[0][2] = -0.381; // rho rho
      g[1][2] = 0.733;
      g[2][2] = 0.166;

      m0[0] = sqrt(2.232);
      m0[1] = sqrt(3.852);
      m0[2] = sqrt(3.663);

      c[0][0] = -2.331;
      c[0][1] = 3.129; c[1][0] = 3.129;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = 4.240;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 1.586;

      d[0][0] = 1.065;
      d[0][1] = 1.228; d[1][0] = 1.228;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = 1.646;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = -0.747;
    }
    else{
      m_model_K = 0;
      m_model_n = 0;

      a[0][0] = 210.226; // pipi
      a[0][1] = 110.799;
      a[0][2] = -505.600;
      a[0][3] = 377.720;

      a[1][0] = 202.815; // KK
      a[1][1] = -289.486;
      a[1][2] = 301.675;
      a[1][3] = -38.537;

      a[2][0] = 0.; // rho rho
      a[2][1] = 0.;
      a[2][2] = 0.;
      a[2][3] = 0.;
      
      g[0][0] = 0.815; // pipi
      g[1][0] = -1.370;
      g[2][0] = 0.672;

      g[0][1] = 0.909; // KK
      g[1][1] = 0.831;
      g[2][1] = -0.943;

      g[0][2] = 1.256; // rho rho
      g[1][2] = -1.185;
      g[2][2] = 2.061;

      m0[0] = sqrt(1.977);
      m0[1] = sqrt(3.181);
      m0[2] = sqrt(3.918);

      c[0][0] = -1.302;
      c[0][1] = 0.404; c[1][0] = 0.404;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = 1.596;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = 3.639;

      d[0][0] = -0.038;
      d[0][1] = 0.114; d[1][0] = 0.114;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.320;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0;
    }
  }
  else if(!model.compare("inputcddcm9newc3")){ // 6
    if(_L==0){
      // nominal, CDD
      m_model_K = 1; // 1
      m_model_n = 1; // 0

      a[0][0] = 510.938; // pipi
      a[0][1] = 929.856;
      a[0][2] = 292.581;
      a[0][3] = -143.562;

      a[1][0] = 941.510; // KK
      a[1][1] = 1796.670;
      a[1][2] = 698.726;
      a[1][3] = -182.237;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.209; // pipi
      g[1][0] = 2.125;
      g[2][0] = 2.496;

      g[0][1] = 1.218; // KK
      g[1][1] = 5.977;
      g[2][1] = 4.818;

      g[0][2] = 0.713; // rho rho
      g[1][2] = -2.331;
      g[2][2] = 1.173;

      m0[0] = sqrt(4.336);
      m0[1] = sqrt(8.957);
      m0[2] = sqrt(5.955);

      c[0][0] = 3.046;
      c[0][1] = 3.989; c[1][0] = 3.989;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = 5.335;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 1.259;

      d[0][0] = -1.529;
      d[0][1] = -1.765; d[1][0] = -1.765;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = 1.956;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0;
    }
    else{
      m_model_K = 0; 
      m_model_n = 1; 

      a[0][0] = -0.170; // pipi
      a[0][1] = -3.471;
      a[0][2] = 1.087;
      a[0][3] = -0.198;

      a[1][0] = 4.705; // KK
      a[1][1] = 6.541;
      a[1][2] = -2.844;
      a[1][3] = -0.893;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -2.127; // pipi
      g[1][0] = 0.779;
      g[2][0] = -11.473;

      g[0][1] = -1.110; // KK
      g[1][1] = 3.257;
      g[2][1] = -6.087;

      g[0][2] = 0.371; // rho rho
      g[1][2] = -0.236;
      g[2][2] = -3.125;

      m0[0] = sqrt(2.140);
      m0[1] = sqrt(2.468);
      m0[2] = sqrt(4.788);

      c[0][0] = -8.984;
      c[0][1] = 4.732; c[1][0] = 4.732;
      c[0][2] = -25.612; c[2][0] = -25.612;
      c[1][1] = 21.301;
      c[1][2] = -6.836; c[2][1] = -6.836;
      c[2][2] = 0.489;

      d[0][0] = -25.360;
      d[0][1] = -14.444; d[1][0] = -14.444;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -8.864;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0;
    }
  }
  else if(!model.compare("inputcddcmnewc3")){ // 7 
    if(_L==0){ 
      // nominal, CDD
      m_model_K = 1; // 1
      m_model_n = 0; // 0

      a[0][0] = 1754.855; // pipi
      a[0][1] = 938.765;
      a[0][2] = -4384.837;
      a[0][3] = 4169.372;

      a[1][0] = 2713.399; // KK
      a[1][1] = 2073.418;
      a[1][2] = -7233.067;
      a[1][3] = 7001.418;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 2.434; // pipi
      g[1][0] = 0.193;
      g[2][0] = 4.591;

      g[0][1] = 1.861; // KK
      g[1][1] = -0.332;
      g[2][1] = 4.786;

      g[0][2] = 1.157; // rho rho
      g[1][2] = -0.052;
      g[2][2] = 1.005;

      m0[0] = sqrt(0.002);
      m0[1] = sqrt(2.098);
      m0[2] = sqrt(5.924);

      c[0][0] = -2.518;
      c[0][1] = 4.076; c[1][0] = 4.076;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = -5.323;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 1.039;

      d[0][0] = 0.085;
      d[0][1] = -1.585; d[1][0] = -1.585;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -2.420;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0.522;
    }
    else{
      m_model_K = 0; 
      m_model_n = 0; 

      a[0][0] = 330.656; // pipi
      a[0][1] = -287.942;
      a[0][2] = 113.164;
      a[0][3] = 0.;

      a[1][0] = 331.662; // KK
      a[1][1] = -404.531;
      a[1][2] = 344.428;
      a[1][3] = 0.; // hier weiter

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -0.588; // pipi
      g[1][0] = 0.015;
      g[2][0] = -0.851;

      g[0][1] = -0.179; // KK
      g[1][1] = 0.714;
      g[2][1] = 1.479;

      g[0][2] = 0.; // rho rho
      g[1][2] = -0.176;
      g[2][2] = -1.951;

      m0[0] = sqrt(1.261);
      m0[1] = sqrt(2.295);
      m0[2] = sqrt(3.760);

      c[0][0] = -0.159;
      c[0][1] = 0.439; c[1][0] = 0.439;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = 0.566;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -27.282;

      d[0][0] = -0.107;
      d[0][1] = 0.048; d[1][0] = 0.048;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.159;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 7.036;
    }
  }
  else if(!model.compare("inputstartcm11new2c3")){ // 8 
    if(_L==0){
      // nominal, CDD
      m_model_K = 0; // 1
      m_model_n = 2; // 0

      a[0][0] = -2173.729; // pipi
      a[0][1] = 3272.052;
      a[0][2] = -1553.726;
      a[0][3] = 361.790;

      a[1][0] = 1927.495; // KK
      a[1][1] = -2996.838;
      a[1][2] = 1354.327;
      a[1][3] = -287.158;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -6.058; // pipi
      g[1][0] = -0.236;
      g[2][0] = 8.295;

      g[0][1] = -7.247; // KK
      g[1][1] = -1.092;
      g[2][1] = 12.908;

      g[0][2] = 1.956; // rho rho
      g[1][2] = -0.233;
      g[2][2] = -1.049;

      m0[0] = sqrt(0.006);
      m0[1] = sqrt(3.184);
      m0[2] = sqrt(7.548);

      c[0][0] = 16.190;
      c[0][1] = 18.308; c[1][0] = 18.308;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = 19.239;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = -15.811;

      d[0][0] = -6.274;
      d[0][1] = -9.197; d[1][0] = -9.197;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -13.371;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 6.031;
    }
    else{
      m_model_K = 0; 
      m_model_n = 2; 

      a[0][0] = 109.759; // pipi
      a[0][1] = -2.844;
      a[0][2] = 71.095;
      a[0][3] = 0.;

      a[1][0] = -26.964; // KK
      a[1][1] = -135.324;
      a[1][2] = -14.887;
      a[1][3] = 0.; 

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.155; // pipi
      g[1][0] = 0.908;
      g[2][0] = 0.852;

      g[0][1] = 1.027; // KK
      g[1][1] = -0.250;
      g[2][1] = 0.698;

      g[0][2] = -0.344; // rho rho
      g[1][2] = 0.;
      g[2][2] = 1.134;

      m0[0] = sqrt(2.330);
      m0[1] = sqrt(1.667);
      m0[2] = sqrt(2.894);

      c[0][0] = -1.170;
      c[0][1] = -1.012; c[1][0] = -1.012;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = 0.395;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -11.365;

      d[0][0] = 0.211;
      d[0][1] = 0.168; d[1][0] = 0.168;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = 0.005;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 3.923;
    }
  }
  else if(!model.compare("inputstartcm133c3")){ // 9 
    if(_L==0){
      // nominal, CDD
      m_model_K = 0; // 1
      m_model_n = 2; // 0

      a[0][0] = -932.715; // pipi
      a[0][1] = 1483.985;
      a[0][2] = -731.004;
      a[0][3] = 205.755;

      a[1][0] = -1667.292; // KK
      a[1][1] = 2545.060;
      a[1][2] = -1171.917;
      a[1][3] = 251.251;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -6.338; // pipi
      g[1][0] = -0.901;
      g[2][0] = -8.789;

      g[0][1] = 4.369; // KK
      g[1][1] = 0.545;
      g[2][1] = 10.425;

      g[0][2] = 2.155; // rho rho
      g[1][2] = -0.646;
      g[2][2] = 1.470;

      m0[0] = sqrt(0.163);
      m0[1] = sqrt(3.219);
      m0[2] = sqrt(6.839);

      c[0][0] = 15.046;
      c[0][1] = -8.388; c[1][0] = -8.388;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = 1.729;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 0.147;

      d[0][0] = -8.312;
      d[0][1] = 7.822; d[1][0] = 7.822;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -7.635;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 1.133;
    }
    else{
      m_model_K = 0; 
      m_model_n = 2; 

      a[0][0] = -5.172; // pipi
      a[0][1] = -11.454;
      a[0][2] = -6.142;
      a[0][3] = -1.515;

      a[1][0] = 5.847; // KK
      a[1][1] = 9.946;
      a[1][2] = 4.692;
      a[1][3] = 0.650; 

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.737; // pipi
      g[1][0] = -3.526;
      g[2][0] = 5.980;

      g[0][1] = 3.629; // KK
      g[1][1] = -5.282;
      g[2][1] = 72.146;

      g[0][2] = 0.; // rho rho
      g[1][2] = 17.600;
      g[2][2] = 3.232;

      m0[0] = sqrt(2.497);
      m0[1] = sqrt(7.033);
      m0[2] = sqrt(18.114);

      c[0][0] = 14.392;
      c[0][1] = -36.041; c[1][0] = -36.041;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = -269.583;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -31.902;

      d[0][0] = 2.431;
      d[0][1] = 5.792; d[1][0] = 5.792;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -20.919;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = -12.643;
    }
  }
  else if(!model.compare("inputstartcm15new2c3")){ // 10 
    if(_L==0){
      // nominal, CDD 
      m_model_K = 0; // 1
      m_model_n = 2; // 0

      a[0][0] = -469.725; // pipi
      a[0][1] = 269.322;
      a[0][2] = 242.570;
      a[0][3] = -176.897;

      a[1][0] = -797.758; // KK
      a[1][1] = 720.403;
      a[1][2] = 658.934;
      a[1][3] = -264.493;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.196; // pipi
      g[1][0] = 0.092;
      g[2][0] = -0.711;

      g[0][1] = -0.071; // KK
      g[1][1] = 0.324;
      g[2][1] = -0.278;

      g[0][2] = -0.678; // rho rho
      g[1][2] = 1.915;
      g[2][2] = 1.761;

      m0[0] = sqrt(2.200);
      m0[1] = sqrt(3.894);
      m0[2] = sqrt(6.029);

      c[0][0] = -0.604;
      c[0][1] = 0.274; c[1][0] = 0.274;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = -0.223;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = -10.869;

      d[0][0] = -0.026;
      d[0][1] = -0.041; d[1][0] = -0.041;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = 0.029;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 2.251;
    }
    else{
      m_model_K = 0; 
      m_model_n = 2; 

      a[0][0] = 107.443; // pipi
      a[0][1] = -98.660;
      a[0][2] = 17.093;
      a[0][3] = 0.;

      a[1][0] = -1.434; // KK
      a[1][1] = 104.271;
      a[1][2] = -34.953;
      a[1][3] = 0.; 

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -0.583; // pipi
      g[1][0] = -0.092;
      g[2][0] = 0.666;

      g[0][1] = -0.341; // KK
      g[1][1] = 0.916;
      g[2][1] = -0.855;

      g[0][2] = 0.; // rho rho
      g[1][2] = 0.381;
      g[2][2] = 1.176;

      m0[0] = sqrt(1.294);
      m0[1] = sqrt(2.349);
      m0[2] = sqrt(3.396);

      c[0][0] = -0.068;
      c[0][1] = 0.563; c[1][0] = 0.563;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = 0.028;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -13.000;

      d[0][0] = -0.128;
      d[0][1] = -0.022; d[1][0] = -0.022;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.049;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 4.910;
    }
  }
  else if(!model.compare("inputstartcm3c3")){ // 11  
    if(_L==0){
      // nominal, CDD
      m_model_K = 0; // 1
      m_model_n = 1; // 0

      a[0][0] = -148.704; // pipi
      a[0][1] = 22.993;
      a[0][2] = -46.336;
      a[0][3] = -29.424;

      a[1][0] = -151.059; // KK
      a[1][1] = 199.470;
      a[1][2] = -118.976;
      a[1][3] = 8.848;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -0.140; // pipi
      g[1][0] = -0.508;
      g[2][0] = 0.094;

      g[0][1] = 0.494; // KK
      g[1][1] = -0.296;
      g[2][1] = 0.383;

      g[0][2] = -1.203; // rho rho
      g[1][2] = -1.133;
      g[2][2] = 2.147;

      m0[0] = sqrt(2.871);
      m0[1] = sqrt(3.485);
      m0[2] = sqrt(4.767);

      c[0][0] = -0.896;
      c[0][1] = 0.120; c[1][0] = 0.120;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = -0.164;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = -2.866;

      d[0][0] = 0.109;
      d[0][1] = 0.117; d[1][0] = 0.117;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.141;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 1.413;
    }
    else{
      m_model_K = 0; 
      m_model_n = 1; 

      a[0][0] = 553.346; // pipi
      a[0][1] = 517.244;
      a[0][2] = 146.930;
      a[0][3] = -113.084;

      a[1][0] = 338.693; // KK
      a[1][1] = 422.754;
      a[1][2] = 24.366;
      a[1][3] = -61.797; 

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -0.460; // pipi
      g[1][0] = -10.429;
      g[2][0] = -0.073;

      g[0][1] = -0.157; // KK
      g[1][1] = 18.872;
      g[2][1] = -0.536;

      g[0][2] = 0.; // rho rho
      g[1][2] = 11.551;
      g[2][2] = -2.784;

      m0[0] = sqrt(1.405);
      m0[1] = sqrt(12.689);
      m0[2] = sqrt(2.305);

      c[0][0] = -8.781;
      c[0][1] = 14.926; c[1][0] = 14.926;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = -24.707;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -1473.973;

      d[0][0] = -0.912;
      d[0][1] = 1.896; d[1][0] = 1.896;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -3.903;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 529.630;
    }
  }
  else if(!model.compare("inputstartcm5newc3")){ // 12 
    if(_L==0){
      // nominal, CDD
      m_model_K = 0; // 1
      m_model_n = 1; // 0

      a[0][0] = 101.592; // pipi
      a[0][1] = -56.789;
      a[0][2] = 29.815;
      a[0][3] = 2.449;

      a[1][0] = 87.441; // KK
      a[1][1] = -148.758;
      a[1][2] = 65.182;
      a[1][3] = -1.447;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.449; // pipi
      g[1][0] = 1.024;
      g[2][0] = -0.242;

      g[0][1] = 0.321; // KK
      g[1][1] = -0.240;
      g[2][1] = 0.722;

      g[0][2] = 2.444; // rho rho
      g[1][2] = 1.189;
      g[2][2] = -1.151;

      m0[0] = sqrt(4.422);
      m0[1] = sqrt(3.790);
      m0[2] = sqrt(2.915);

      c[0][0] = -2.868;
      c[0][1] = 1.398; c[1][0] = 1.398;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = -1.020;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = -3.823;

      d[0][0] = 0.523;
      d[0][1] = -0.091; d[1][0] = -0.091;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.023;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 1.684;
    }
    else{
      m_model_K = 0; 
      m_model_n = 1; 

      a[0][0] = -345.394; // pipi
      a[0][1] = -424.460;
      a[0][2] = -148.391;
      a[0][3] = -10.501;

      a[1][0] = -228.989; // KK
      a[1][1] = -355.615;
      a[1][2] = -118.982;
      a[1][3] = -32.925; 

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.895; // pipi
      g[1][0] = -0.437;
      g[2][0] = 7.338;

      g[0][1] = 0.346; // KK
      g[1][1] = 1.625;
      g[2][1] = -6.178;

      g[0][2] = 0.; // rho rho
      g[1][2] = 1.631;
      g[2][2] = 2.296;

      m0[0] = sqrt(1.580);
      m0[1] = sqrt(2.639);
      m0[2] = sqrt(9.927);

      c[0][0] = -4.870;
      c[0][1] = 6.106; c[1][0] = 6.106;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = -4.188;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -41.959;

      d[0][0] = -0.813;
      d[0][1] = 0.071; d[1][0] = 0.071;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = 0.276;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 16.097;
    }
  }
  else if(!model.compare("inputstartcm6new2c3")){ // 13 
    if(_L==0){
      // nominal, CDD
      m_model_K = 0; // 1
      m_model_n = 0; // 0

      a[0][0] = 847.432; // pipi
      a[0][1] = 333.631;
      a[0][2] = -2065.505;
      a[0][3] = 1277.216;

      a[1][0] = -926.057; // KK
      a[1][1] = -5.761;
      a[1][2] = 1707.496;
      a[1][3] = -946.449;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -7.977; // pipi
      g[1][0] = 0.144;
      g[2][0] = 0.467;

      g[0][1] = -0.451; // KK
      g[1][1] = -0.490;
      g[2][1] = 0.262;

      g[0][2] = -1.310; // rho rho
      g[1][2] = -1.886;
      g[2][2] = 0.441;

      m0[0] = sqrt(12.905);
      m0[1] = sqrt(3.720);
      m0[2] = sqrt(2.280);

      c[0][0] = -6.586;
      c[0][1] = -2.053; c[1][0] = -2.053;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = -2.010;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = -10.627;

      d[0][0] = -0.422;
      d[0][1] = 0.322; d[1][0] = 0.322;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = 0.613;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 2.078;
    }
    else{
      m_model_K = 0; 
      m_model_n = 0; 

      a[0][0] = -264.241; // pipi
      a[0][1] = 514.992;
      a[0][2] = -371.164;
      a[0][3] = 211.769;

      a[1][0] = -29.752; // KK
      a[1][1] = 312.992;
      a[1][2] = -171.984;
      a[1][3] = 229.967; 

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.945; // pipi
      g[1][0] = 0.400;
      g[2][0] = -6.513;

      g[0][1] = -0.366; // KK
      g[1][1] = 1.141;
      g[2][1] = -1.371;

      g[0][2] = 0.; // rho rho
      g[1][2] = -1.157;
      g[2][2] = -1.004;

      m0[0] = sqrt(1.569);
      m0[1] = sqrt(2.542);
      m0[2] = sqrt(5.297);

      c[0][0] = -4.308;
      c[0][1] = -4.938; c[1][0] = -4.938;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = 3.268;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -9.988;

      d[0][0] = -4.149;
      d[0][1] = 1.007; d[1][0] = 1.007;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.316;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 3.230;
    }
  }
  else if(!model.compare("inputstartcmnew2c3")){ // 14 
    if(_L==0){
      // nominal, CDD
      m_model_K = 0; // 1
      m_model_n = 0; // 0

      a[0][0] = 208.290; // pipi
      a[0][1] = -528.939;
      a[0][2] = 424.750;
      a[0][3] = -28.494;

      a[1][0] = -142.327; // KK
      a[1][1] = 1692.850;
      a[1][2] = -2708.631;
      a[1][3] = 1282.757;

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = 0.043; // pipi
      g[1][0] = 0.185;
      g[2][0] = 0.540;

      g[0][1] = 0.658; // KK
      g[1][1] = -0.431;
      g[2][1] = -0.155;

      g[0][2] = 0.766; // rho rho
      g[1][2] = 1.559;
      g[2][2] = 1.160;

      m0[0] = sqrt(3.024);
      m0[1] = sqrt(4.804);
      m0[2] = sqrt(3.448);

      c[0][0] = -0.775;
      c[0][1] = -0.005; c[1][0] = -0.005;
      c[0][2] = 0; c[2][0] = 0;
      c[1][1] = -0.129;
      c[1][2] = 0; c[2][1] = 0;
      c[2][2] = 2.127;

      d[0][0] = 0.053;
      d[0][1] = -0.138; d[1][0] = -0.138;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.189;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 0.406;
    }
    else{
      m_model_K = 0; 
      m_model_n = 0; 

      a[0][0] = 1433.350; // pipi
      a[0][1] = -885.882;
      a[0][2] = -549.160;
      a[0][3] = 974.603;

      a[1][0] = 213.773; // KK
      a[1][1] = -467.329;
      a[1][2] = -24.108;
      a[1][3] = -88.659; 

      a[2][0] = 0; // rho rho
      a[2][1] = 0;
      a[2][2] = 0;
      a[2][3] = 0;

      g[0][0] = -0.539; // pipi
      g[1][0] = 0.429;
      g[2][0] = -1.908;

      g[0][1] = 0.369; // KK
      g[1][1] = 1.192;
      g[2][1] = -13.069;

      g[0][2] = 1.615; // rho rho
      g[1][2] = -1.205;
      g[2][2] = -0.575;

      m0[0] = sqrt(1.562);
      m0[1] = sqrt(2.679);
      m0[2] = sqrt(18.039);

      c[0][0] = -0.678;
      c[0][1] = -2.125; c[1][0] = -2.125;
      c[0][2] = 0.; c[2][0] = 0.;
      c[1][1] = -8.882;
      c[1][2] = 0.; c[2][1] = 0.;
      c[2][2] = -5.600;

      d[0][0] = 0.121;
      d[0][1] = 0.134; d[1][0] = 0.134;
      d[0][2] = 0; d[2][0] = 0;
      d[1][1] = -0.560;
      d[1][2] = 0; d[2][1] = 0;
      d[2][2] = 3.876;
    }
  }

  TGraphErrors *gPIPI = new TGraphErrors();
  gPIPI->SetMarkerStyle(22);
  gPIPI->SetMarkerSize(1.);
  gPIPI->SetMarkerColor(kBlack);
  TGraphErrors *gKK = new TGraphErrors();
  gKK->SetMarkerStyle(21);
  gKK->SetMarkerSize(1.);
  gKK->SetMarkerColor(kGray+1);
  string line;

  ifstream inPIPI("pipi_BESIII.txt");
  int cnt = 0;
  while(inPIPI.is_open() && getline(inPIPI,line)){
    istringstream ss(line);
    // mass I_0 E_0 I_2E1 E_2E1 I_2M2 E_2M2 I_2E3 E_2E3 P_0,2E1 E_0,2E1 P_2M2,2E1 E_2M2,2E1 P_2E3,2E1 E_2E3,2E1 I_total E_total 
    string s1, s2, s3, s4, s5;
    ss >> s1 >> s2 >> s3 >> s4 >> s5;
    double m = atof(s1.c_str());
    double y, erry;
    if(_L==0){
      y = atof(s2.c_str());
      erry = atof(s3.c_str());
    }
    else{
      y = atof(s4.c_str());
      erry = atof(s5.c_str());
    }
    gPIPI->SetPoint(cnt,m,y);
    gPIPI->SetPointError(cnt++,0,erry);
  }

  ifstream inKK("KK_BESIII.txt");
  cnt = 0;
  while(inKK.is_open() && getline(inKK,line)){
    istringstream ss(line);
    // mass I_0 E_0 I_2E1 E_2E1 I_2M2 E_2M2 I_2E3 E_2E3 P_0,2E1 E_0,2E1 P_2M2,2E1 E_2M2,2E1 P_2E3,2E1 E_2E3,2E1 I_total E_total 
    string s1, s2, s3, s4, s5;
    ss >> s1 >> s2 >> s3 >> s4 >> s5;
    double m = atof(s1.c_str());
    double y, erry;
    if(_L==0){
      y = atof(s2.c_str());
      erry = atof(s3.c_str());
    }
    else{
      y = atof(s4.c_str());
      erry = atof(s5.c_str());
    }
    gKK->SetPoint(cnt,m,y);
    gKK->SetPointError(cnt++,0,erry);
  }

  TF1 *f = new TF1("f",plotAmp2,1,2.5,2);
  TCanvas *can = new TCanvas();
  f->SetParameter(1,_L);
  if(_L){
    gPIPI->Draw("ap");
    gPIPI->GetXaxis()->SetRangeUser(1,2.5);
    gKK->Draw("same p");
    f->SetParameter(0,0);
    f->SetLineColor(kRed);
    f->DrawCopy("same");
    f->SetParameter(0,1);
    f->SetLineColor(kBlue);
    f->DrawCopy("same");
  }
  else{
    gKK->Draw("ap");
    gKK->GetXaxis()->SetRangeUser(1,2.5);
    gPIPI->Draw("same p");
    f->SetParameter(0,1);
    f->SetLineColor(kBlue);
    f->DrawCopy("same");
    f->SetParameter(0,0);
    f->SetLineColor(kRed);
    f->DrawCopy("same");
  }
  can->SaveAs("plot.png");
}
